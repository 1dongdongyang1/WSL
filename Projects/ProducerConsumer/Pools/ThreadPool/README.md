# 线程池

## 1.技术脉络

> 1. 技术是什么？
> 2. 技术解决了什么样的问题？
> 3. 技术是如何解决问题的？
> 4. 技术在工作中以及在开源框架中是怎样应用的？

1. 技术是什么？

+ 线程池是池化技术的一种, 是生产消费模型的一种具体实现。
+ 池化技术是一种**资源管理思想**，通过预先创建一定数量的可复用资源，并将它们集中存放在“池”中，由统一的管理器进行分配和回收，从而减少资源的频繁创建和销毁开销，提高系统性能与资源利用率。
+ 线程池就是把多个线程放在一个“池子”里。

2. 技术解决了什么样的问题？

+ 性能开销大 → 频繁创建/销毁线程浪费 CPU 和内存。
+ 线程数量失控 → 太多线程会导致上下文切换过多甚至 OOM。
+ 缺乏统一管理 → 无法统计线程状态、无法统一控制任务优先级和超时。

线程池的出现，就是为了解决这些资源浪费 + 无法管理的问题。

3. 技术是如何解决问题的？
核心思路：

提前准备：启动时就创建一批线程，放在池中等待任务。

任务复用：来一个任务就分配一个空闲线程执行，执行完再放回池中，而不是销毁。

统一调度：有个任务队列存放待执行任务，线程空闲时从队列取任务。

数量控制：可限制核心线程数、最大线程数、队列大小，避免线程泛滥。

一个简化版的线程池运行流程：

text
复制
编辑
任务提交 -> 放进任务队列 -> 空闲线程取任务 -> 执行 -> 线程回到池子等待下一个任务
关键机制：

线程复用 → 减少频繁创建销毁的开销。

任务排队 → 控制并发量，平稳运行。

拒绝策略 → 队列满时有不同的处理方式（丢任务、抛异常、调用者执行等）。

4. 技术在工作中以及在开源框架中的应用
工作中的应用
后端服务：处理 HTTP 请求、数据库异步查询、文件 I/O。

爬虫系统：多线程抓取网页，但要限制并发量防止封 IP。

日志异步写入：主线程快速返回，把日志交给线程池异步写磁盘。

游戏服务器：处理大量玩家请求和消息推送。

开源框架中的应用
Java：

java.util.concurrent.ThreadPoolExecutor 是标准线程池实现。

ForkJoinPool 用于并行计算（JDK8 parallelStream() 背后就是它）。

Spring Boot：

@Async 注解背后依赖线程池执行异步任务。

WebFlux、定时任务调度也使用线程池。

C++：

Boost.Thread 提供线程池模式支持。

Muduo 网络库里会用线程池处理事件循环（IO线程 + 计算线程）。

Python：

concurrent.futures.ThreadPoolExecutor 用于并发任务执行。